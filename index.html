<!DOCTYPE html>
<html lang="en" >
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Place</title>

    <!--bootstrap cdn CSS file link-->
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!--Custome CSS file link-->
    <link rel="stylesheet" href="http://newphp21-env.us-east-2.elasticbeanstalk.com/placeCus.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css'>

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-animate.min.js"></script>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.21.0/moment.min.js"></script>

</head>

<body ng-app='myApp' ng-controller="MyCtrl">

<div class="cover" id="cover"></div>
<div class="container" id="container">
    
    <div class="row">
        <div class="col-xl-1"></div>
        <div class="col-xl-10 col-lg-12 col-md-12 col-sm-12">
            <form class="formBorder" name="myform" id="myform" onsubmit="return false;">
                <div class="col-xl-12">
                    <div class="form-group">
                        <div align="center" id="headerstyle"><h5>Travel and Entertainment Search</h5></div>
                    </div>
                    <div class="form-group row">
                        <div class="col-xl-2 col-lg-2 col-md-2 col-sm-12"></div>
                        <label class="col-xl-2 col-lg-2 col-md-2 col-form-label"><b>Keyword<b style='color:red;'>*</b> </b></label>
                        <div class="col-xl-6 col-lg-6 col-md-6">
                        <input type="text" class="form-control" name="keword" id="keword" onfocusout="keyupfun()" onkeyup="keyupfun()" required>
                            <div class="invalid-feedback"><b>
                            Please Enter a Valid Keyword.</b>
                        </div>
                        <div class="valid-feedback">
                        </div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-xl-2 col-lg-2 col-md-2 col-sm-12"></div>
                        <label class="col-xl-2 col-lg-2 col-md-2 col-form-label"><b>Category </b></label>
                        <div class="col-xl-4 col-lg-4 col-md-4">
                            <select name="category" id="category" class="form-control">
                                <option selected=selected value="default">Default</option>
                                <option value="airport">Airport</option>
                                <option value="amusement_park">Amusement Park</option>
                                <option value="aquarium">Aquarium</option>
                                <option value="art_gallery">Art Gallery</option>
                                <option value="bakery">Bakery</option>
                                <option value="bar">Bar</option>
                                <option value="beauty_salon">Beauty Salon</option>
                                <option value="bowling_alley">Bowling Alley</option>
                                <option value="bus_station">Bus Station</option>
                                <option value="cafe">Cafe</option>
                                <option value="campground">Campground</option>
                                <option value="car_rental">Car Rental</option>
                                <option value="casino">Casino</option>
                                <option value="lodging">Lodging</option>
                                <option value="movie_theater">Movie Theater</option>
                                <option value="museum">Museum</option>
                                <option value="night_club">Night Club</option>
                                <option value="park">Park</option>
                                <option value="parking">Parking</option>
                                <option value="restaurant">Restaurant</option>
                                <option value="shopping_mall">Shopping Mall</option>
                                <option value="stadium">Stadium</option>
                                <option value="subway_station">Subway Station</option>
                                <option value="taxi_stand">Taxi Stand</option>
                                <option value="train_station">Train Station</option>
                                <option value="transit_station">Transit Station</option>
                                <option value="travel_agency">Travel Agency</option>
                                <option value="zoo">Zoo</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-xl-2 col-lg-2 col-md-2 col-sm-12"></div>
                        <label class="col-xl-2 col-lg-2 col-md-2 col-form-label"><b>Distance (miles) </b></label>
                        <div class="col-xl-4 col-lg-4 col-md-4">
                            <input type="text" class="form-control" name="distance" id="distance" placeholder="10">
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-xl-2 col-lg-2 col-md-2 col-sm-12"></div>
                        <label class="col-xl-2 col-lg-2 col-md-2 col-form-label"><b>From<b style='color:red;'>*</b> </b></label>
                        <div class="col-xl-6 col-lg-6 col-md-6">
                            <input type="radio" name="loc" id="here1" value="here1" onclick="disableBox()" checked>
                            <label for="here1">Current location</label><br>
                            <input type="radio" name="loc" id="here2" value="here2" onclick="disableBox()">
                            <label for="here2">Other. Please specify:</label><br>
                            <input type="text" class="radio_txt form-control" name="location" id="location" placeholder="Enter a location" onfocusout="keyupfunloc()" onkeyup="keyupfunloc()" disabled="disabled">
                            <div class="invalid-feedback radio_txt"><b>
                            Please Enter a valid Location.</b>
                        </div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-xl-2 col-lg-2 col-md-2 col-sm-12"></div>
                        <div class="col-xl-4 col-lg-4 col-md-4">
                            <button type="submit" name="submit" id="search" class='btn btn-primary' disabled="disabled"><i class="fa fa-search"  disabled="disabled"> Search</i></button>
                            <input type="button" name="clear"  value="Clear" class="btn btn-outline-secondary clear" onclick="resetform()">
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <br><br>

    <div class="row">
        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12" align="center">
            <input type="button" class='btn btn-primary' value="Results" onclick="showTheResults()" style="border: none;" id='showresults'/>
            <input type="button" class="btn fav" value="Favorites" onclick="showFavResults(true)" style="border: none;" id='showfavorites'/>
        </div>
    </div>

    <div ng-hide="book" class="animate-show" id='showAnimated'>
        <div id='mydivtab'>
            <div id='forotherone'>


                <div id="myTable" style="display: none;">

                </div>
                <div id="nextprev">

                </div>
            </div>
        </div>
    </div>

    <div  ng-hide="myValue" class="animate-hide">

    <div id="placehead" class="col-xl-12 col-lg-12 col-md-12 col-sm-12" align="center">

    </div>

    <div id="listandtwit" class='row invisible' style="margin-bottom: 1%;">

    </div>

    <div id="navbarb">
        <ul class="nav nav-tabs justify-content-end">
            <li class="nav-item linktext" onclick="showInfo()">
                <a class="nav-link active" id='infoli'>Info</a>
            </li>
            <li class="nav-item linktext" onclick="showPhotos()">
                <a class="nav-link" id='photoli'>Photos</a>
            </li>
            <li class="nav-item linktext" onclick="showMap()">
                <a class="nav-link" id='mapli'>Map</a>
            </li>
            <li class="nav-item linktext" onclick="showReviews()">
                <a class="nav-link" id='revli'>Reviews</a>
            </li>
        </ul>
    </div>

    <div id="infoTabb">
    </div>

    </div>
    <div id='myPhotoTab'>
    </div>

    <div id="photossTab">
    </div>

    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Open Hours</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="modal-body">
        
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="myModalfortwit" tabindex="-1" role="dialog" aria-labelledby="examplemodalfortwittwe" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content" id="modal-content">
                <div class="modal-body" id="modal-body">

                </div>
            </div>
        </div>
    </div>

    <div id="mapForm">
        <form>
            <div class="form-row">
                <div class="form-group col-xl-4 col-lg-4 col-md-6 col-sm-12 col-xs-12">
                    <label class="form-label-sm" for="from">From</label>
                    <input type="text" class="form-control form-control-sm" id="from" onfocusout="keyupfunloca()" onkeyup="keyupfunloca()" value="Your Location">
                    <div class='invalid-feedback'>
                        Please enter a Location.
                    </div>
                </div>
                <div class="form-group col-xl-4 col-lg-4 col-md-6 col-sm-12 col-xs-12">
                    <label class="form-label-sm" for="to">to</label>
                    <input type="text" class="form-control form-control-sm" id="to" disabled="disabled" style="font-weight: bold;">
                </div>
                <div class="form-group col-xl-2 col-lg-2 col-md-6 col-sm-12 col-xs-12">
                    <label class="form-label-sm" for="travel_mode">Travel Mode</label>
                    <select class="form-control form-control-sm" id="travel_mode">
                        <option value="DRIVING">Driving</option>
                        <option value="BICYCLING">Bicycling</option>
                        <option value="TRANSIT">Transit</option>
                        <option value="WALKING">Walking</option>
                    </select>
                </div>
                <div class="form-group col-xl-2 col-lg-2 col-md-6 col-sm-4 col-4">
                    <label class="form-label-sm d-none d-md-block d-lg-block d-xl-block" for="get_dir"> &nbsp;</label>
                    <input type="button" class="form-control form-control-sm btn-sm btn-primary" id="get_dir" value="Get Directions" onclick="displayDirec(from.value,travel_mode.value)">
                </div>
            </div>
        </form>
        <button style="padding: 0px; margin: 0px; margin-bottom: 1%; border:2px solid #eee; border-radius: 4px; cursor:pointer;" onclick="streetViewToggle()"><img src="http://cs-server.usc.edu:45678/hw/hw8/images/Pegman.png" width="40px" height="40px" id="imageicon"/></button>
        <input type='hidden' id='hiddenNum'/>
        <input type="hidden" id='recentlyfavadded'/>
        <input type="hidden" id='recentlyvisited'/>
        <input type="hidden" id="recentlydeleted"/>
        <input type="hidden" id="numofcurrent">
        <input type="hidden" id="sometextfield"/>
    </div>


    <div id="map" class="invisible"></div>
    <div id="mapPanel"></div>

    <div id="mapend"></div>

    <div id="cardrevspace">
        
    
    </div>
    <div id="cardspace" ng-show="show" class="fade-in-out">
    </div>
    <div id="cardspaced" ng-show="showed" class="fade-in-out">
    </div>
    <div id="cardspacen"></div>

    <div id="dummyDiv" style="display: none;"></div>
    
  
</div>

<!-- Modal -->

<script language="JavaScript" type="text/javascript">


    lastpage = -1;
    listofplace = [];
    rateg = [];
    rategdate = [];
    rategf = [];
    rategfdate = [];
    showresulys = [];
    listtostorepages = [];
    var zero_results = "";
    var zero_reviews = "";
    var zero_photos = "";
    var no_of_photos = "";
    var jsonDataa = "";
    var reviewsData = "";
    var reviewsYText = "";
    var reviewsText = "";
    var lat = "";
    var lng = "";
    var map;
    var maptab = "";
    var userLng;
    var userLat;
    var gotOrig = false;
    var directionsDisplay;
    var setPanelx = false;
    var addToFavL = false;
    var yelpRev = false;
    var googleRev = false;
    var hightolow;
    var lowtohight = false;
    var numofButt;
    var toggle = false;
    var detailsbut = false;
    var showFavTxt = "";
    var isinfavtab = false;
    var detdeleted = false;
    var dataforstar = "";
    var pageno = -1;
    var shouldishow = false;
    var favjustanim = false;
    var place_num_fav;
    var favpageno;

    var app = angular.module("myApp", ["ngAnimate"]);
        app.controller("MyCtrl", function ($scope) {
        $scope.myValue = true;
        $scope.book = false;
        $scope.show = false;
        $scope.showed = false;
        });

        

    $('#myModal').on('shown.bs.modal', function () {

        $('#myInput').focus();

    });

    $('#myModalfortwit').on('shown.bs.modal',function(){
        $('#myInput').focus();
    });

    function resetform(){
        document.getElementById("myform").reset();
        document.getElementById("recentlyvisited").value = "";
        $("#photossTab").css("display","none");
        $("#mapForm").css("display","none");
        $("#showresults").removeClass().addClass("btn btn-primary");
        $("#showfavorites").removeClass().addClass("btn fav");
        $("#map").removeClass("visible").addClass("invisible");
        setPanelx = false;
        $("#mapPanel").html('');
        $("#mapend").html('');
        $("#map").css("height","1px");
        $("#infoTabb").html('');
        $("#listandtwit").removeClass("visible").addClass("invisible");
        $("#myTable").css("display","none");
        $("#placehead").html('');
        $("#navbarb").css("display","none");
        $("#cardspace").html('');
        $("#cardspaced").html('');
        $("#cardspacen").html('');
        $("#cardrevspace").html('');
        $("#nextprev").html('');
        pageno = -1;
    }

    //Resets all the fields of form and fetches location and if location is obtained search button is enabled
    $(document).ready(function () {

        document.myform.reset();
        if(localStorage.getItem("arrforlocalstorage")){
            showFavResults(false);
        }
        //
        //document.getElementById('search').disabled=false;
        //$("#search").css("background-color", "dodgerblue");
        

    });

    function initMap(){
        var autocomplete;
        var input = document.getElementById('location');
        var userFromloc = document.getElementById('from');
        var options = {types: ['geocode']};
        autocomplete = new google.maps.places.Autocomplete(input,options);
        autocomplete = new google.maps.places.Autocomplete(userFromloc,options);

        $.getJSON("http://ip-api.com/json", function(result,status,errorthrown){
            if(result.status === "success") {
                lat = result.lat;
                lng = result.lon;
                dest = {lat:lat, lng:lng};
                myMap(dest);
            }
        }).fail(function() {
      $("#myTable").html("<br><br><br><br><div class='alert alert-danger' role='alert'>Failed to get Location.</div><br><br><br><br>").css("display","block");
  });;

    }

    function myMap(dest){
            mapOptions = {
                zoom: 15,
                center : dest,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                streetViewControl: false
            };
            map = new google.maps.Map(document.getElementById('map'), mapOptions);

            
    }

    $("#search").on("click",function() {

        $("#myTable").html("<br><br><br><br><br><div class='progress'><div class='progress-bar progress-bar-striped progress-bar-animated' role='progressbar' aria-valuenow='50' aria-valuemin='0' aria-valuemax='100' style='width: 50%''></div></div><br><br><br><br>").removeClass("invisible").addClass("visible").css("display","block");
        $("#nextprev").html('');
        detailsbut = false;
        setPanelx = false;
        isinfavtab = false;

        $("#listandtwit").removeClass("visible").addClass("invisible");
        $("#photossTab").css("display","none");
        $("#mapForm").css("display","none");
        $("#map").removeClass("visible").addClass("invisible");
        $("#mapPanel").html('');
        $("#mapend").html('');
        $("#map").css("height","1px");
        $("#placehead").html('');
        $("#navbarb").css("display","none");
        $("#showresults").removeClass().addClass("btn btn-primary");
        $("#showfavorites").removeClass().addClass("btn fav");
        //alert("submitted");

        //Clearing all divs
        //$("#myTable").removeClass("visible").addClass("invisible").css("z-index","-100");
        /*document.getElementById("firstBut").innerHTML = "";
        document.getElementById("firstMsg").innerHTML = "";
        document.getElementById("secBut").innerHTML = "";
        document.getElementById("secMsg").innerHTML = "";
        document.getElementById("map").style.display = "none";
        document.getElementById("listonmap").style.display = "none";*/

        var location = "";

        //Fetching all the variable values for textbox to send as parameters
        var keword = $("#keword").val();

        //Checking if custom location is given by user
        if($("#here2").is(':checked')){
            location = $("#location").val();
            //alert(location);
        }
        else{
            location = "hereloc";
        }

            if (location !== "" && keword !== "") {

                var category = $("#category").val();
                var distance = 10;

                if ($("#distance").val() !== "") {
                    distance = $("#distance").val();
                }

                var url = "http://newphp21-env.us-east-2.elasticbeanstalk.com/place.php?keword=" + keword + "&category=" + category + "&distance=" + distance + "&location=" + location + "&lat=" + lat + "&lng=" + lng;
                //alert(url);

                //Sending request to php to get reviews and photos JSON
                
                $.getJSON(url, function(result){
                    //alert("atlease inside");
                    pageno = 0;
                    for(j=0;j<listofplace.length;j++){
                        listofplace[j] = "";
                    }
                    //alert(result);
                    displayTable(result,pageno);
                }).fail(function(){
                    $("#myTable").html("<br><br><br><br><div class='alert alert-danger' role='alert'>Failed to get Search Results. Please check your internet connection.</div><br><br><br><br>").css("display","block");
                });
            
            }

    });


    

    $("#newWindowOpen").click(function() {
                window.open($(this).attr('href').attr("target","_blank"),'title', 'width=800, height=700');
                return false;
    }); 
    function displayTable(jsonData,pageno){
        if(jsonData.result){
            if(jsonData.result === "ZERO_RESULTS"){
                $("#myTable").html("<br><br><br><br><div class='alert alert-warning' role='alert'>No Records.</div><br><br><br><br>").css("display","block");
            } else {
                    $("#myTable").html("<br><br><br><br><div class='alert alert-danger' role='alert'>Failed to get Search Results.</div><br><br><br><br>").css("display","block");
            }

        } else {
        
        len = jsonData.results.length;
        isinfavtab = false;
        //alert(jsonData.next_page_token);

        tabtext = "<br><div class='row'><div class='col-xl-12 col-lg-12 col-md-12 col-sm-12' align='right'><input type='button' value='Details &gt;' onclick='giveDet(-2)' class='btn btn-outline-secondary clear' disabled='disabled' id='detailsbutt'/></div></div><br>";

        tabtext += "<div class='table-responsive'><table class=\"table table-hover table-dark\" id='myfirsttable'><thead><tr><th>#</th><th>Category</th><th>Name</th><th>Address</th><th>Favorite</th><th>Details</th></tr></thead>";
        if(localStorage.getItem("arrforlocalstorage")){
            var strorh = localStorage.getItem("arrforlocalstorage");
        var resultsofst = strorh.split(",");
        }
        

        for (var i = 0; i < len; i++) {
            //alert((pageno*20)+i);
            var isitin = false;
            tabtext += "<tbody><tr id='forbg"+i+"'>";
            tabtext += "<td>"+((pageno*20)+i+1)+"</td>";
            tabtext += "<td><img src=\'" + jsonData.results[i].icon + "\' width=\"25px\" height=\"25px\"/></td>";
            tabtext += "<td class=\"text-nowrap\">"+jsonData.results[i].name +"</td>";
            tabtext += "<td class=\"text-nowrap\"><a class=\"tabdata\"> " + jsonData.results[i].vicinity + "</td>";

            if(localStorage.getItem("arrforlocalstorage")){
                for(m=0;m<resultsofst.length;m++){
                if(jsonData.results[i].place_id == resultsofst[m]){
                    isitin = true;
                }
            }
            if(isitin == true){
                tabtext += "<td align='left' class='text-nowrap'><button class='btn btn-sm forhover' id='addToFavB"+((pageno*20)+i)+"' onclick='addToFavList("+((pageno*20)+i)+")' style='border:1px solid #bbb;' name='Added"+((pageno*20)+i)+"'><i class='fa fa-star' style='color:rgb(242,198,37);' id='addToFav" +((pageno*20)+i)+ "'></i></button></td>";
            } else {
                tabtext += "<td align='left'><button class='btn btn-sm forhover' style='border:1px solid #bbb;' id='addToFavB"+((pageno*20)+i)+"' onclick='addToFavList("+((pageno*20)+i)+")' name='notAdded'><i class='fa fa-star-o' id='addToFav" +((pageno*20)+i)+ "'></i></button></td>";
            }
        } else {
            tabtext += "<td align='left'><button class='btn btn-sm forhover' style='border:1px solid #bbb;' id='addToFavB"+((pageno*20)+i)+"' onclick='addToFavList("+((pageno*20)+i)+")' name='notAdded'><i class='fa fa-star-o' id='addToFav" +((pageno*20)+i)+ "'></i></button></td>";
        }  
            
            tabtext += "<td><input type='button' class='btn btn-sm forhover' style='border:1px solid #bbb;' value='&gt;' onclick='giveDet("+((pageno*20)+i)+")'></td>";
            //alert("addToFavList("+ (i) +")");
            tabtext += "</tr></tbody>";
        }
        tabtext = tabtext + "</table></div>";
        jsonDataa = jsonData;

        

        listofplace[pageno] = tabtext;
        showresulys[pageno] = jsonDataa;


        if(jsonData.next_page_token) {
            pagetkn = jsonData.next_page_token;
        }else{
            lastpage = pageno;
        }

        if($("#here2").is(':checked')){
            
            userLat = jsonData.lat;
            userLng = jsonData.longi;
            //alert(location);
        }

        $("#myTable").css("display","block");
        
        $("#myTable").html(listofplace[pageno]).removeClass("invisible").addClass("visible");
        displayBut();
        //prev_num = 1000;

    }

    }

    

    function displayBut() {
            if(pageno === 0 && pageno === lastpage){
                nextprev = "";
            }
            else if(pageno === 0){
                nextprev = "<div class='row'><div class='col-xl-12 col-lg-12 col-md-12 col-sm-12' align='center'><input type='button' value='Next' class='btn btn-outline-secondary clear' onclick='showNextRes()'/></div></div><br>"
            }
            else if(pageno === lastpage){
                nextprev = "<div class='row'><div class='col-xl-12 col-lg-12 col-md-12 col-sm-12' align='center'><input type='button' value='Previous' class='btn btn-outline-secondary clear' onclick='showPrevRes()'/></div></div><br>"
            }
            else{
                nextprev = "<div class='row'><div class='col-xl-12 col-lg-12 col-md-12 col-sm-12' align='center'><input type='button' class='btn btn-outline-secondary clear' value='Previous' onclick='showPrevRes()'/>&nbsp;&nbsp;<input type='button' class='btn btn-outline-secondary clear' value='Next' onclick='showNextRes()'/></div></div><br>"
            }
            $("#nextprev").html(nextprev);

    }
    function showNextRes(){
        $("#nextprev").html('');
        $("#myTable").html("<br><br><br><br><br><div class='progress'><div class='progress-bar progress-bar-striped progress-bar-animated' role='progressbar' aria-valuenow='50' aria-valuemin='0' aria-valuemax='100' style='width: 50%''></div></div><br><br><br><br>").removeClass("invisible").addClass("visible").css("display","block");
        pageno += 1;
        if(listofplace[pageno]){
            

            $("#myTable").html(listofplace[pageno]);
            mydata = showresulys[pageno];
            var stroredArra = localStorage.getItem("arrforlocalstorage");
            var resultsofst = stroredArra.split(",");
            for(i=0;i<mydata.results.length;i++){
                var itshere = false;
                for(m=0;m<resultsofst.length;m++){
                    
                    if(mydata.results[i].place_id == resultsofst[m]){
                        itshere = true;
                    }

                }
                if(itshere == true){
                    //alert(pageno);
                    $("#addToFav"+((pageno*20)+i)).removeClass("fa-star-o").addClass("fa-star").css("color","rgb(242,198,37)");
                    document.getElementById("addToFavB"+((pageno*20)+i)).name="Added";
                }else{
                    $("#addToFav"+((pageno*20)+i)).removeClass().addClass("fa fa-star-o").css("color","black");
                    document.getElementById("addToFavB"+((pageno*20)+i)).name="notAdded";
                }
            }
            $("#myTable").css("display","block");
            displayBut();
        }
        else {
            var urlnext = "http://newphp21-env.us-east-2.elasticbeanstalk.com/place.php?pagetoken=" + pagetkn + "";
            $.getJSON(urlnext, function (result,status) {
                //alert("atlease inside");
                //alert(status);
                displayTable(result, pageno);
            }).fail(function() {
      $("#myTable").html("<br><br><br><br><div class='alert alert-danger' role='alert'>Failed to get Search Result. Please check your internet connection.</div><br><br><br><br>").css("display","block");
        });
        }
    }
    function showPrevRes() {
        $("#nextprev").html('');
        $("#myTable").html("<br><br><br><br><br><div class='progress'><div class='progress-bar progress-bar-striped progress-bar-animated' role='progressbar' aria-valuenow='50' aria-valuemin='0' aria-valuemax='100' style='width: 50%''></div></div><br><br><br><br>").removeClass("invisible").addClass("visible").css("display","block");
        detailsbut = false;
        pageno = pageno - 1;
        //alert(pageno);
        //alert(listofplace[pageno]);
        $("#myTable").html(listofplace[pageno])
        mydata = showresulys[pageno];
        if(localStorage.getItem("arrforlocalstorage")){
            var stroredArra = localStorage.getItem("arrforlocalstorage");
            var resultsofst = stroredArra.split(",");
            for(i=0;i<mydata.results.length;i++){
                var itshere = false;
                for(m=0;m<resultsofst.length;m++){
                    
                    if(mydata.results[i].place_id == resultsofst[m]){
                        itshere = true;
                    }

                }
                if(itshere == true){
                    //alert(pageno);
                    $("#addToFav"+((pageno*20)+i)).removeClass("fa-star-o").addClass("fa-star").css("color","rgb(242,198,37)");
                    document.getElementById("addToFavB"+((pageno*20)+i)).name="Added";
                }else{
                    $("#addToFav"+((pageno*20)+i)).removeClass().addClass("fa fa-star-o").css("color","black");
                    document.getElementById("addToFavB"+((pageno*20)+i)).name="notAdded";
                }
        }
            
                
            }
        $("#myTable").css("display","block");
        displayBut();
    }

    function disableBox() {
        if ($("#here1").is(':checked')) {
                $("#location").removeClass("is-invalid");
                keyupfun();
            $("#location").prop( "disabled", true ).val("").placeholder = "location";
        }
        if ($("#here2").is(':checked')) {
            document.getElementById("search").disabled=true;
            $("#location").prop( "disabled", false ).required = true;
        }
    }

    function keyupfun(){
        kewordd = document.getElementById('keword').value;
        if(kewordd.trim().length == 0){
            $("#keword").addClass("is-invalid");
            document.getElementById("search").disabled = true;
        } else {
            $("#keword").removeClass("is-invalid");
            if($("#here2").is(":checked")){
                if(document.getElementById('location').value.trim().length > 0){
                        document.getElementById("search").disabled = false;
                }
                else{
                    $("#location").addClass("is-invalid");
                    document.getElementById("search").disabled = true;
                }
            }
            else{
                 document.getElementById("search").disabled = false;
            }
            
        }
    }

    function keyupfunloca(){
        if(document.getElementById("from").value.trim().length == 0){
            $("#from").addClass("is-invalid");
            document.getElementById("get_dir").disabled = true;
        }
        else{
            $("#from").removeClass("is-invalid");
            document.getElementById("get_dir").disabled = false;
        }

    }

    function keyupfunloc(){
        kewordd = document.getElementById('location').value;
        if($("#here2").is(":checked")){
            
            if(kewordd.trim().length == 0){
            $("#location").addClass("is-invalid");
            document.getElementById("search").disabled = true;
        }
        else{
            $("#location").removeClass("is-invalid");
            document.getElementById("search").disabled = false;
            keyupfun();
        }
        } else {
            $("#location").removeClass("is-invalid");
        }
        
    }

    function giveDet(num, placeidfav, row) {

        
        $("#nextprev").html('');
        //$("#map").css("display","none");
        //$("#listonmap").css("display","none");
        zero_results = false;
        zero_reviews = false;
        zero_photos = false;
        no_of_photos = "";
        var name_of_place = "";
        //alert(num);
        //alert(placeidfav);

        if(num==-2){
            num = document.getElementById('hiddenNum').value;
        }
        //alert(num);
        numofList = num;

        if(num > 19){
            num = num % 20 ;   
        }

        if(placeidfav == undefined && num >= 0){
            placeidfav = "undefinedvalue";
            //alert(placeidfav);
            givenplaceid = showresulys[pageno].results[num].place_id;
        }
        else{
            givenplaceid = placeidfav;
            if(placeidfav != undefined){
                document.getElementById("recentlyvisited").value = placeidfav;
                document.getElementById("hiddenNum").value = num;
            }
            
        }

        if(row == undefined){
            row = "dummy";
        }
        else{
            numofList = row;
        }
        //alert(jsonDataa.results[num].place_id);
        if(num == -1){
            numofres = document.getElementById('hiddenNum').value;
            givenplaceid = document.getElementById("recentlyvisited").value;
            if(document.getElementById("recentlyvisited").value == document.getElementById("recentlydeleted").value){
                numofList = -300;
                document.getElementById("recentlydeleted").value = "justdeleted";
            }
            else{
                numofList = numofres;
            }
            
        }
        var request = {
            placeId: givenplaceid
        };
        service = new google.maps.places.PlacesService(map);
        
        service.getDetails(request, function(place, status) {
            if (status == google.maps.places.PlacesServiceStatus.OK) {
                dataforstar = place;
                //alert(JSON.stringify(dataforstar));
                displayReview(place, numofList);
            }
            else{
                $("#myTable").html("<br><br><br><br><div class='alert alert-danger' role='alert'>Something went wrong !! Failed to get Place Details !!</div><br><br><br><br>").css("display","block");
            }
        });
    
    }

    function showFavResults(canIshow){
        favjustanim = false;
        var there_is_a_place = false;
        if(localStorage.getItem("arrforlocalstorage")){
            stroredArray = localStorage.getItem("arrforlocalstorage");
        var resultsofst = stroredArray.split(",");
        }
        
        
        if(resultsofst && resultsofst != "" && resultsofst.length >= 1){
            favpageno = 0;
            place_num_fav =0;
            //alert(resultsofst.length);
            if(resultsofst.length > 20){
                showFavTxt = "<br><div class='row'><div class='col-xl-12 col-lg-12 col-md-12 col-sm-12' align='right'><input type='button' value='Details &gt;' onclick='giveDet(-1)' class='btn btn-outline-secondary clear' disabled='disabled' id='detailsbuttg'/></div></div><br><div class='table-responsive'><table class=\"table table-hover\"><thead><tr><th>#</th><th>Category</th><th>Name</th><th>Address</th><th>Favorite</th><th>Details</th></tr></thead><tbody>";
                for(lo=0;lo<20;lo++){
            var storedplaceid = localStorage.getItem(resultsofst[lo]);
            storedplaceid = JSON.parse(storedplaceid);
            if(document.getElementById("recentlyvisited").value == storedplaceid.place_id){
                showFavTxt += "<tr id='forbgk"+lo+"' style='background-color:rgb(254,223,150);' class='hujyhusj'><td>"+(lo+1)+"</td>";
                there_is_a_place = true;
                place_num_fav = favpageno;
            }
            else{
                showFavTxt += "<tr id='forbgk"+lo+"'><td>"+(lo+1)+"</td>";
            }
            
            showFavTxt += "<td><img src=\'" + storedplaceid.icon + "\' width=\"25px\" height=\"25px\"/></td>";
            showFavTxt += "<td class=\"text-nowrap\"><a onclick='giveDet(-3,\""+storedplaceid.place_id+"\","+lo+")'>" + storedplaceid.name + "</a></td>";
            showFavTxt += "<td class='text-nowrap'>"+storedplaceid.vicinity+"</td>";
            showFavTxt += "<td align='left'><button class='btn btn-sm forhover' style='border:1px solid #bbb;' onclick='removeFromFavList("+lo+",\""+storedplaceid.place_id+"\")' name='Added'><i class='fa fa-trash'></i></button></td>";

            showFavTxt += "<td><input type='button' class='btn btn-sm forhover' value='&gt;' style='border:1px solid #bbb;' onclick='giveDet(-3,\""+storedplaceid.place_id+"\","+lo+")'></td></tr>";
                }
            showFavTxt += "</tbody></table></div><div align='center'><input type='button' class='btn btn-outline-secondary clear' onclick='shownextfav()' value='Next'/></div>";
            listtostorepages[favpageno] = showFavTxt;
            favpageno = favpageno + 1;

            showFavTxt = "<br><div class='row'><div class='col-xl-12 col-lg-12 col-md-12 col-sm-12' align='right'><input type='button' value='Details' onclick='giveDet(-1)' class='btn btn-outline-secondary clear' disabled='disabled' id='detailsbuttg'/></div></div><br><div  class='table-responsive'><table class=\"table table-hover\"><thead><tr><th>#</th><th>Category</th><th>Name</th><th>Address</th><th>Favorite</th><th>Details</th></tr></thead><tbody>";
            for(lo=20;lo<resultsofst.length;lo++){
            var storedplaceid = localStorage.getItem(resultsofst[lo]);
            storedplaceid = JSON.parse(storedplaceid);
            if(document.getElementById("recentlyvisited").value == storedplaceid.place_id){
                showFavTxt += "<tr id='forbgk"+lo+"' style='background-color:rgb(254,223,150);' class='hujyhusj'><td>"+(lo+1)+"</td>";
                there_is_a_place = true;
                place_num_fav = favpageno;
            }
            else{
                showFavTxt += "<tr id='forbgk"+lo+"'><td>"+(lo+1)+"</td>";
            }
            
            showFavTxt += "<td><img src=\'" + storedplaceid.icon + "\' width=\"25px\" height=\"25px\"/></td>";
            showFavTxt += "<td class=\"text-nowrap\"><a onclick='giveDet(-3,\""+storedplaceid.place_id+"\","+lo+")'>" + storedplaceid.name + "</a></td>";
            showFavTxt += "<td class='text-nowrap'>"+storedplaceid.vicinity+"</td>";
            showFavTxt += "<td align='left'><button class='btn btn-sm forhover' style='border:1px solid #bbb;' onclick='removeFromFavList("+lo+",\""+storedplaceid.place_id+"\")' name='Added'><i class='fa fa-trash'></i></button></td>";

            showFavTxt += "<td><input type='button' class='btn btn-sm forhover' value='&gt;' style='border:1px solid #bbb;' onclick='giveDet(-3,\""+storedplaceid.place_id+"\","+lo+")'></td></tr>";
                }
            showFavTxt += "</tbody></table></table></div><br><div align='center'><input type='button' class='btn btn-outline-secondary clear' onclick='showprevfav()' value='Previous'/></div>";
            listtostorepages[favpageno] = showFavTxt;
            } else {
                showFavTxt = "<br><div class='row'><div class='col-xl-12 col-lg-12 col-md-12 col-sm-12' align='right'><input type='button' value='Details' onclick='giveDet(-1)' class='btn btn-outline-secondary clear' disabled='disabled' id='detailsbuttg'/></div></div><br><div  class='table-responsive'><table class=\"table table-hover\"><thead><tr><th>#</th><th>Category</th><th>Name</th><th>Address</th><th>Favorite</th><th>Details</th></tr></thead><tbody>";
                for(lo=0;lo<resultsofst.length;lo++){
            var storedplaceid = localStorage.getItem(resultsofst[lo]);
            storedplaceid = JSON.parse(storedplaceid);
            if(document.getElementById("recentlyvisited").value == storedplaceid.place_id){
                showFavTxt += "<tr id='forbgk"+lo+"' style='background-color:rgb(254,223,150);' class='hujyhusj'><td>"+(lo+1)+"</td>";
                there_is_a_place = true;
                place_num_fav = favpageno;
            }
            else{
                showFavTxt += "<tr id='forbgk"+lo+"'><td>"+(lo+1)+"</td>";
            }
            
            showFavTxt += "<td><img src=\'" + storedplaceid.icon + "\' width=\"25px\" height=\"25px\"/></td>";
            showFavTxt += "<td class=\"text-nowrap\"><a onclick='giveDet(-3,\""+storedplaceid.place_id+"\","+lo+")'>" + storedplaceid.name + "</a></td>";
            showFavTxt += "<td class='text-nowrap'>"+storedplaceid.vicinity+"</td>";
            showFavTxt += "<td align='left'><button class='btn btn-sm forhover' style='border:1px solid #bbb;' onclick='removeFromFavList("+lo+",\""+storedplaceid.place_id+"\")' name='Added'><i class='fa fa-trash'></i></button></td>";

            showFavTxt += "<td><input type='button' class='btn btn-sm forhover' value='&gt;' style='border:1px solid #bbb;' onclick='giveDet(-3,\""+storedplaceid.place_id+"\","+lo+")'></td></tr>";
                }
            showFavTxt += "</tbody></table></div>";
            listtostorepages[favpageno] = showFavTxt;
            }
            
        if(canIshow){
            //alert(shouldishow);
            if(shouldishow == true){
            favjustanim = true;
            $("#mydivtab").removeClass("animated slideInRight");
            $("#mydivtab").addClass("animated slideInRight");
            var elemWithScope = document.querySelector('[ng-app=myApp]');
            var $scope = angular.element(elemWithScope).scope();
            $scope.$apply(function() {
            $scope.myValue = true;
            $scope.book = false;
            });
            }
            setPanelx = false;
            $("#infoTabb").html('');
            $("#listandtwit").removeClass("visible").addClass("invisible");
            $("#placehead").html('');
            $("#navbarb").css("display","none");
            $("#photossTab").css("display","none");
            $("#mapForm").css("display","none");
            $("#map").removeClass("visible").addClass("invisible");
            $("#mapPanel").html('');
            $("#mapend").html('');
            $("#cardspace").html('');
            $("#cardspaced").html('');
            $("#cardspacen").html('');
            $("#cardrevspace").html('');
            $("#map").css("height","1px");
            $("#nextprev").html('');
            $("#showresults").removeClass("btn-primary").addClass("fav");
            $("#showfavorites").removeClass("fav").addClass("btn-primary");
            $("#myTable").css("display","block");
            //alert('here');
            $("#myTable").html(listtostorepages[place_num_fav]);
            $(".hujyhusj").mouseover(function(){
                    $(".hujyhusj").css("background-color","#eee");
                });
                $(".hujyhusj").mouseout(function(){
                    $(".hujyhusj").css("background-color","rgb(254,223,150)");
                });
                if(document.getElementById("detailsbuttg").disabled){
                    if(pageno < 0){
                document.getElementById("detailsbuttg").disabled = true;
            }
            if(there_is_a_place){
                document.getElementById("detailsbuttg").disabled = false;
            }
            if(document.getElementById("recentlydeleted").value == "justdeleted"){
                document.getElementById("detailsbuttg").disabled = true;
                document.getElementById("recentlydeleted").value = "nothing";
            }
                }
            
            isinfavtab = true;
            $("#nextprev").html('');
        }
        } else {
            if(canIshow){
                if(shouldishow == true){
                    favjustanim = true;
            $("#mydivtab").removeClass("animated slideInRight");
            $("#mydivtab").addClass("animated slideInRight");
            var elemWithScope = document.querySelector('[ng-app=myApp]');
            var $scope = angular.element(elemWithScope).scope();
            $scope.$apply(function() {
            $scope.myValue = true;
            $scope.book = false;
            });
            }
                setPanelx = false;
            $("#infoTabb").html('');
            $("#listandtwit").removeClass("visible").addClass("invisible");
            $("#placehead").html('');
            $("#navbarb").css("display","none");
            $("#photossTab").css("display","none");
            $("#mapForm").css("display","none");
            $("#map").removeClass("visible").addClass("invisible");
            $("#mapPanel").html('');
            $("#mapend").html('');
            $("#cardspace").html('');
            $("#cardspaced").html('');
            $("#cardspacen").html('');
            $("#cardrevspace").html('');
            $("#map").css("height","1px");
            $("#showresults").removeClass("btn-primary").addClass("fav");
            $("#showfavorites").removeClass("fav").addClass("btn-primary");
            $("#myTable").html("<br><br><br><br><div class='alert alert-warning' role='alert'>No Records.</div><br><br><br><br>").css("display","block");
            }
            $("#nextprev").html('');
            
        }
        
    }

    function showprevfav(){
        $("#myTable").html(listtostorepages[0]);
    }

     function shownextfav(){
        $("#myTable").html(listtostorepages[1]);
    }

    function removeFromFavList(remitem,idtorem){
        //alert(idtorem);
        stroredArray = localStorage.getItem("arrforlocalstorage");
        //alert(stroredArray);
        stroredArray = stroredArray.replace(idtorem, "");
        stroredArray = stroredArray.replace(",,", ",");
        if(stroredArray[0] == ","){
            stroredArray = stroredArray.substr(1,stroredArray.length);
        }
        if(stroredArray[stroredArray.length-1] == ","){
            stroredArray = stroredArray.substr(0,stroredArray.length-1);
        }
        //lert(stroredArray);
        localStorage.setItem("arrforlocalstorage",stroredArray);
        document.getElementById('hiddenNum').value = remitem;
        document.getElementById('recentlydeleted').value = idtorem;
        if(isinfavtab){
            document.getElementById("sometextfield").value = 'noshow';
            showFavResults(true);
        }
        localStorage.removeItem(idtorem);
    }

    function addToFavList(numL){

        if(numL < 0){
            numfor = document.getElementById("numofcurrent").value;
            //alert(numfor);
            placeidfg = dataforstar.place_id;
            var placeidthere = false;
            var numFav1 = numfor;
            //alert(numFav1);
            if(numfor > 19){
                    numFav1 = numfor % 20 ;   
                }
            if(localStorage.getItem("arrforlocalstorage")){
                var mystore = localStorage.getItem("arrforlocalstorage");
                var resultsofst = mystore.split(",");
                for(po = 0;po<resultsofst.length;po++){
                    if(placeidfg == resultsofst[po]){
                        placeidthere = true;
                    }
                }
            }
            if(placeidthere){
                removeFromFavList(numFav1,placeidfg);
                $("#addToFav"+numfor).removeClass("fa-star").addClass("fa-star-o").css("color","black");
                $("#colorifFav").removeClass("fa-star").addClass("fa-star-o").css("color","black");
                //document.getElementById("addToFavB"+numfor).name = "notAdded";
            }
            else{
                $("#addToFav"+numfor).removeClass("fa-star-o").addClass("fa-star").css("color","rgb(242,198,37)");
                document.getElementById("addToFavB"+numfor).name = "Added";
                $("#colorifFav").removeClass("fa-star-o").addClass("fa-star").css("color","rgb(242,198,37)");
                var localstorage_text = "{\"icon\" : \""+showresulys[pageno].results[numFav1].icon+"\", \"name\" : \""+showresulys[pageno].results[numFav1].name+"\", \"vicinity\":\""+showresulys[pageno].results[numFav1].vicinity+"\",\"place_id\":\""+showresulys[pageno].results[numFav1].place_id+"\"}";

                var placeidforfav = showresulys[pageno].results[numFav1].place_id;


                localStorage.setItem( placeidforfav , localstorage_text);

                if(localStorage.getItem("arrforlocalstorage")){
                    var arrforlocalst = localStorage.getItem("arrforlocalstorage");
                    arrforlocalst = arrforlocalst  + "," + placeidforfav;
                    localStorage.setItem("arrforlocalstorage",arrforlocalst);
                    //ChIJu4k1wy7BwoARppcHjy6Vad4
                }
                else{
                    localStorage.setItem("arrforlocalstorage",placeidforfav);
                }
                document.getElementById("recentlyvisited").value = placeidforfav;

                showFavResults(false);
            }
        }
        else{
            var ifAdded = document.getElementById("addToFavB"+numL).name;
                if(ifAdded[0] == "n"){
                    var numFav = numL;
                if(numFav > 19){
                    numFav = numFav % 20 ;
                }

                $("#addToFav"+numL).removeClass("fa-star-o").addClass("fa-star").css("color","rgb(242,198,37)");
                document.getElementById("addToFavB"+numL).name = "Added";

                var localstorage_text = "{\"icon\" : \""+showresulys[pageno].results[numFav].icon+"\", \"name\" : \""+showresulys[pageno].results[numFav].name+"\", \"vicinity\":\""+showresulys[pageno].results[numFav].vicinity+"\",\"place_id\":\""+showresulys[pageno].results[numFav].place_id+"\"}";

                var placeidforfav = showresulys[pageno].results[numFav].place_id;

                localStorage.setItem( placeidforfav , localstorage_text);

                if(localStorage.getItem("arrforlocalstorage")){
                    var arrforlocalst = localStorage.getItem("arrforlocalstorage");
                    arrforlocalst = arrforlocalst  + "," + placeidforfav;
                    localStorage.setItem("arrforlocalstorage",arrforlocalst);
                    //ChIJu4k1wy7BwoARppcHjy6Vad4
                }
                else{
                    localStorage.setItem("arrforlocalstorage",placeidforfav);
                }
                showFavResults(false);
                document.getElementById("sometextfield").value = 'noshow';
                }else{
                    numFav = numL;

                    if(numFav > 19){
                    numFav = numFav % 20 ;   
                    }
                    place_idsd = showresulys[pageno].results[numFav].place_id;
                    //alert(place_idsd);
                    removeFromFavList(numFav,place_idsd);

                    $("#addToFav"+numL).removeClass("fa-star").addClass("fa-star-o").css("color","black");
                    document.getElementById("addToFavB"+numL).name = "notAdded";

                }
        }
          
    }

    function showTheResults(){
        //var nameofAddButt = document.getElementById('shouldIAdd').name;

        if(shouldishow == true && favjustanim != true){
            $("#forotherone").removeClass("animated slideInRight");
            $("#forotherone").addClass("animated slideInRight");
        }
        placeidtobedone = document.getElementById("recentlyvisited").value;
        $("#showfavorites").removeClass("btn-primary").addClass("fav");
        $("#showresults").removeClass("fav").addClass("btn-primary");
        $("#photossTab").css("display","none");
        $("#mapForm").css("display","none");
        $("#map").removeClass("visible").addClass("invisible");
        setPanelx = false;
        $("#mapPanel").html('');
        $("#mapend").html('');
        $("#map").css("height","1px");
        $("#infoTabb").html('');
        $("#listandtwit").removeClass("visible").addClass("invisible");
        $("#placehead").html('');
        $("#navbarb").css("display","none");
        var elemWithScope = document.querySelector('[ng-app=myApp]');
        var $scope = angular.element(elemWithScope).scope();
        $scope.$apply(function() {
            $scope.myValue = true;
            $scope.book = false;
        });
        $("#cardspace").html('');
        $("#cardspaced").html('');
        $("#cardspacen").html('');
        $("#cardrevspace").html('');
        tobeaddednum = -1;
        if(pageno >= 0){
            mydata = showresulys[pageno];
            $("#myTable").html(listofplace[pageno]);
            itshere =false;
            if(localStorage.getItem("arrforlocalstorage")){
                var stroredArra = localStorage.getItem("arrforlocalstorage");
            var resultsofst = stroredArra.split(",");
            for(i=0;i<mydata.results.length;i++){
                var itshere = false;
                for(m=0;m<resultsofst.length;m++){
                    
                    if(mydata.results[i].place_id == resultsofst[m]){
                        itshere = true;
                    }

                }
                if(placeidtobedone == mydata.results[i].place_id){
                    tobeaddednum = i;
                }
                if(itshere == true){
                    //alert(pageno);
                    $("#addToFav"+((pageno*20)+i)).removeClass("fa-star-o").addClass("fa-star").css("color","rgb(242,198,37)");
                    document.getElementById("addToFavB"+((pageno*20)+i)).name="Added";
                }
                else{
                    $("#addToFav"+((pageno*20)+i)).removeClass().addClass("fa fa-star-o").css("color","black");
                    document.getElementById("addToFavB"+((pageno*20)+i)).name="notAdded";
                }
            }
            document.getElementById("detailsbutt").disabled = true;
            if(tobeaddednum >= 0){
                document.getElementById("detailsbutt").disabled = false;
                $("#forbg"+tobeaddednum).css("background-color","rgb(254,223,150)");
            $("#forbg"+tobeaddednum).mouseover(function(){
                 $("#forbg"+tobeaddednum).css("background-color","#eee");
            });
            $("#forbg"+tobeaddednum).mouseout(function(){
                 $("#forbg"+tobeaddednum).css("background-color","rgb(254,223,150)");
            });
            }
                
            }
            
            $("#myTable").css("display","block");
            
            displayBut();
        }
        else{
            $("#myTable").html("<br><br><br><br><div class='alert alert-warning' role='alert'>No Records.</div><br><br><br><br>").css("display","block");
        }
    }

    function showTheList(){
        shouldishow = false;
        var numofButt = document.getElementById('shouldIAdd').name;

        var elemWithScope = document.querySelector('[ng-app=myApp]');
        var $scope = angular.element(elemWithScope).scope();
        $scope.$apply(function() {
            $scope.showed = false;
            $scope.show = false;
        });
        var classList = document.getElementById('showfavorites').className.split(/\s+/);
        for (var i = 0; i < classList.length; i++) {
        if (classList[i] === 'btn-primary') {
            isinfavtab = true;
            }
        }
        
        //alert(pageno);
        $("#photossTab").css("display","none");
        $("#mapForm").css("display","none");
        $("#map").removeClass("visible").addClass("invisible");
        setPanelx = false;
        $("#mapPanel").html('');
        $("#mapend").html('');
        $("#map").css("height","1px");
        $("#infoTabb").html('');
        $("#listandtwit").removeClass("visible").addClass("invisible");
        $("#placehead").html('');
        $("#navbarb").css("display","none");
        var elemWithScope = document.querySelector('[ng-app=myApp]');
        var $scope = angular.element(elemWithScope).scope();
        $scope.$apply(function() {
            $scope.myValue = true;
            $scope.book = false;
        });
        $("#showAnimated").addClass("animated slideInRight");
        $("#cardspace").html('');
        $("#cardspaced").html('');
        $("#cardspacen").html('');
        $("#cardrevspace").html('');
        
        
        $("#myTable").html(listofplace[pageno]).css("display","block");
        $("#myfirsttable").removeClass().addClass("table table-hover table-dark");
        //alert(numofButt);
        if(numofButt > 19){
            numofButt = numofButt%20;
        }
        document.getElementById("hiddenNum").value = numofButt;
        if(document.getElementById("detailsbutt") != null){
            document.getElementById("detailsbutt").disabled = false;
        }
        
        if(isinfavtab){
        $("#nextprev").html('');
        showFavResults(true);
        }
        else{
            itshere = false;
            mydata = showresulys[pageno];
            if(localStorage.getItem("arrforlocalstorage")){
                var stroredArra = localStorage.getItem("arrforlocalstorage");
            var resultsofst = stroredArra.split(",");
            for(i=0;i<mydata.results.length;i++){
                var itshere = false;
                for(m=0;m<resultsofst.length;m++){
                    
                    if(mydata.results[i].place_id == resultsofst[m]){
                        itshere = true;
                    }


            }
                if(itshere == true){
                    //alert(pageno);
                    $("#addToFav"+((pageno*20)+i)).removeClass("fa-star-o").addClass("fa-star").css("color","rgb(242,198,37)");
                    document.getElementById("addToFavB"+((pageno*20)+i)).name="Added";
                }else{
                    $("#addToFav"+((pageno*20)+i)).removeClass().addClass("fa fa-star-o").css("color","black");
                    document.getElementById("addToFavB"+((pageno*20)+i)).name="notAdded";
                }
            }
                
            }

            document.getElementById("recentlyvisited").value = mydata.results[numofButt].place_id;
            displayBut();
            $("#forbg"+numofButt).css("background-color","rgb(254,223,150)");
            $("#forbg"+numofButt).mouseover(function(){
                 $("#forbg"+numofButt).css("background-color","#eee");
            });
            $("#forbg"+numofButt).mouseout(function(){
                 $("#forbg"+numofButt).css("background-color","rgb(254,223,150)");
            });
        }



        //alert(document.getElementById("recentlyvisited").value);

    }

    function displayReview(placeData, numofList){

            var no_of_dollars = "";
            var no_of_stars = "";
            var open_now = "";
            var day = moment().day();
            var photo;

            if(day == 0){
                day = 6;
            }
            //alert(placeData.place_id);
            if(placeData.price_level){
                for(i=0;i<parseInt(placeData.price_level);i++){
                    no_of_dollars += "$";
                }
            }
            if(placeData.opening_hours){
                if(placeData.opening_hours.open_now){ 
                open_now = "Open Now: "+ placeData.opening_hours.weekday_text[day-1];
                }
                else{
                    open_now = "Closed";
                }
            }
            if(placeData.rating){
                var stars = (placeData.rating/5)*74;
                no_of_stars += "<span class='star-rating'>"+placeData.rating +" <span class='front-stars' style='width:"+stars+"%'><i class='fa fa-star'></i><i class='fa fa-star'></i><i class='fa fa-star'></i><i class='fa fa-star'></i><i class='fa fa-star'></i></span></span>";
            }

            $("#placehead").html("<br><h5>" + placeData.name + "<h5>");

                twitText = "<div class='col-6' align='left'><button class='btn btn-sm' style='background-color:white; border:2px solid #eee;' onclick='showTheList()'>&lt; List</button></div><div class='col-6' align='right'><button class='btn btn-sm' style='background-color:white; border:2px solid #eee; margin-right:1%;' id='shouldIAdd' name='num' onclick='addToFavList(-1)'><i class='fa fa-star-o' id='colorifFav'></i></button><a href='https://twitter.com/share?";
                if(placeData.website){
                    twitText += "url=" + placeData.website;
                }
                else if(placeData.url){
                    twitText += "url=" + placeData.url;
                }

                var w = window.innerWidth/2 - 250;
                var h = window.innerHeight/2 - 250;

                nameofplaace = placeData.name.replace(/'/g, "&#39;");

                twitText += "&related=twitterapi%2Ctwitter&hashtags=TravelAndEntertainmentSearch&text=Check out "+nameofplaace+" located at "+placeData.formatted_address+". Website:' onclick=\"window.open(this.href, 'mywin','left="+w+",top="+h+",width=500,height=500,toolbar=1,resizable=0'); return false;\"><img src='http://cs-server.usc.edu:45678/hw/hw8/images/Twitter.png' width='32px' height='32px'></a></div>";

                 $("#listandtwit").html(twitText);

                document.getElementById("shouldIAdd").name = numofList;

            if(numofList != -300){
                detdeleted = false;

                
            } else {
                detdeleted = true;
            }

            document.getElementById("numofcurrent").value = numofList;
            //alert(document.getElementById("numofcurrent").value);
            if(localStorage.getItem("arrforlocalstorage")){
                stroredArray = localStorage.getItem("arrforlocalstorage");
            var resultsofst = stroredArray.split(",");
            for(n=0;n<resultsofst.length;n++){
                //alert(resultsofst[n]);
                //alert(placeData.place_id);
                if(placeData.place_id == resultsofst[n]){
                    $("#colorifFav").removeClass("fa-star-o").addClass("fa-star");
                    $("#colorifFav").css("color","rgb(242,198,37)");
                }
            }
            }
            

            $("#listandtwit").removeClass("invisible").addClass("visible");

            $("#navbarb").css("display","block");

            if(placeData.formatted_address){
               info = "<br><div  class='table-responsive'><table ng-app='myApp' ng-controller='MyCtrl' class=\"table table-striped\"><tr><th class='text-nowrap'>Address</th><td class='text-nowrap'>"+placeData.formatted_address+"</td></tr>";
            }
            if(placeData.international_phone_number){
                info += "<tr><th class='text-nowrap'>Phone Number</th><td class='text-nowrap'>"+placeData.international_phone_number+"</td></tr>";
            }
            if(placeData.price_level){
                info += "<tr><th class='text-nowrap'>Price Level</th><td class='text-nowrap'>"+no_of_dollars+"</td></tr>";
            }
            if(placeData.rating){
                info += "<tr><th class='text-nowrap'>Rating</th><td class='text-nowrap'>"+no_of_stars+"</td></tr>";
            }
            if(placeData.url){
                info += "<tr><th class='text-nowrap'>Google Page</th><td class='text-nowrap'><a href='"+placeData.url+"' target='_blank'>"+placeData.url+"</a></td></tr>";
            }
            if(placeData.website){
                info += "<tr><th class='text-nowrap'>Website</th><td class='text-nowrap'><a href='"+placeData.website+"' target='_blank'>"+placeData.website+"</a></td></tr>";
            }
            if(placeData.opening_hours){
                info += "<tr><th>Hours</th><td class='text-nowrap'>"+open_now;
                if(placeData.opening_hours.weekday_text[0]){
                        info += "<button type='button' class='btn btn-sm fav' style='margin-top:-0.7%;' data-toggle='modal' data-target='#myModal'><u>Daily Open Hours</u></button></td></tr></table></div>";
                }
                else{
                    info += "</td></tr></table></div>";
                }
            }
            
            var widthh = $("#myTable").width();
            
            var photostab1 = "";
            var photostab2 = "";
            var photostab3 = "";
            var photostab4 = "";
            if(placeData.photos != undefined){
                var noofphotos = placeData.photos.length;
                var modim = noofphotos % 4;
                var noloop = (noofphotos-modim)/4;
                for(l=0;l<noloop;l++){
                    try{
                       photo1 = placeData.photos[(l*4)].getUrl({'maxWidth': widthh});
                    photostab1 += "<a href='"+photo1+"' target='_blank'><img src='"+photo1+"' style='width:100%'></a>"; 
                    photo2 = placeData.photos[(l*4)+1].getUrl({'maxWidth': widthh});
                    photostab2 += "<a href='"+photo1+"' target='_blank'><img src='"+photo2+"' style='width:100%'></a>";
                    photo3 = placeData.photos[(l*4)+2].getUrl({'maxWidth': widthh});
                    photostab3 += "<a href='"+photo1+"' target='_blank'><img src='"+photo3+"' style='width:100%'></a>";
                    photo4 = placeData.photos[(l*4)+3].getUrl({'maxWidth': widthh});
                    photostab4 += "<a href='"+photo1+"' target='_blank'><img src='"+photo4+"' style='width:100%'></a>";
                    }
                    catch (e){
                        photostab = "<br><br><br><br><div class='alert alert-danger' role='alert'>Failed to get photos.</div><br><br><br><br>";
                    }
                    
                }
                var modim1 = modim;
                if(modim > 0){
                    try{
                    photo1 = placeData.photos[noofphotos-modim1].getUrl({'maxWidth': widthh});
                    photostab1 += "<a href='"+photo1+"' target='_blank'><img src='"+photo1+"' style='width:100%'></a>";
                    modim = modim-1;
                    if(modim > 0){
                        photo2 = placeData.photos[noofphotos-modim1+1].getUrl({'maxWidth': widthh});
                        photostab2 += "<a href='"+photo2+"' target='_blank'><img src='"+photo2+"' style='width:100%'></a>";
                        modim = modim-1;
                        if(modim > 0){
                            photo3 = placeData.photos[noofphotos-modim1+2].getUrl({'maxWidth': widthh});
                            photostab3 += "<a href='"+photo3+"' target='_blank'><img src='"+photo3+"' style='width:100%'></a>";
                            modim = modim-1;
                        }
                    }
                }
                catch(e){
                    photostab = "<br><br><br><br><div class='alert alert-danger' role='alert'>Failed to get photos.</div>";
                }
                }
                if(photostab1 != ""){
                    photostab = "<div class='row1'><div class='column1'>"+photostab1+"</div><div class='column1'>"+photostab2+"</div><div class='column1'>"+photostab3+"</div><div class='column1'>"+photostab4+"</div></div>";
                }
                
            }

            if(placeData.photos == undefined){
                photostab = "<br><br><br><br><div class='alert alert-warning' role='alert'>No Records.</div><br><br><br><br>";
            }

            $("#photossTab").html(photostab);
        

            reviewsData = placeData;
           //alert(placeData);

            var alert_text = "<table class='table'>";
            var cover = document.getElementById('cover');
            if(placeData.opening_hours != null){
                var dow = moment().day();
                //alert(placeData.opening_hours.weekday_text[dow]);
                //alert(moment().day());
                if(placeData.opening_hours.weekday_text[0]){
                        for(k=0;k<placeData.opening_hours.weekday_text.length;k++) {
                            if(dow>7){
                                dow = 1;
                            }
                            if(dow == 0){
                                val = placeData.opening_hours.weekday_text[6];
                            } else {
                                val = placeData.opening_hours.weekday_text[dow-1];
                            }
                            //alert(val);
                            var firstPart = val.substr(0, val.indexOf(":"));
                            var secPart = val.substr(val.indexOf(":") + 1, val.length);
                            dow += 1;
                            if(k == 0){
                                alert_text += "<tr><td><b>"+firstPart+"</b></td><td><b>"+secPart+"</b></td></tr>";
                            } else {
                                alert_text += "<tr><td>"+firstPart+"</td><td>"+secPart+"</td></tr>";
                            }
                            
                        }
                }
            }
            
            alert_text += "</table>";

            cover.style.width =  $(document).width() + "px";
            cover.style.height = $(document).height() + "px";
            //cover.style.display = "block";
            
            $("#modal-body").html(alert_text);

            document.getElementById("to").value = placeData.name + " , " + placeData.formatted_address;

            maptab = "<br>";

            //dest = {lat: parseFloat(placeData.geometry.location.lat), lng: parseFloat(placeData.geometry.location.lng)};


            //alert(placeData.geometry.location);

            mapOptions = {
                zoom: 15,
                center : placeData.geometry.location,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            map = new google.maps.Map(document.getElementById('map'), mapOptions);
            var marker1 = new google.maps.Marker({
                map: map,
                position: placeData.geometry.location
            });

            panorama = map.getStreetView();
            panorama.setPosition(reviewsData.geometry.location);
            panorama.setPov(/** @type {google.maps.StreetViewPov} */({
            heading: 265,
            pitch: 0
            }));
            document.getElementById("travel_mode").value = "DRIVING";

            if($("#here2").is(":checked")){
                document.getElementById('from').value = document.getElementById('location').value;
            }
            else{
                document.getElementById('from').value = "Your Location";
            }


            reviewsHeadText = "<div class='row'><div class='dropdown' style='margin-top:1.5%; margin-bottom:1.5%; margin-left:2%;'><button class='btn btn-secondary dropdown-toggle' type='button' id='dropdownMenuButton' data-toggle='dropdown' aria-haspopup='true' aria-expanded='false'>Google Reviews</button><div class='dropdown-menu' aria-labelledby='dropdownMenuButton'><a class='dropdown-item' onclick='showReviews()'>Google Reviews</a><a class='dropdown-item' onclick='showYelRev()'>Yelp Reviews</a></div></div><div class='dropdown' style='margin-top:1.5%; margin-bottom:1.5%; margin-left:1%;'><button class='btn btn-secondary dropdown-toggle' type='button' id='dropdownOrderMenuButton' data-toggle='dropdown' aria-haspopup='true' aria-expanded='false'>Default Order</button><div class='dropdown-menu' aria-labelledby='dropdownOrderMenuButton'><a class='dropdown-item' onclick='defaultOrder()'>Default Order</a><a class='dropdown-item' onclick='highRateOrder()'>Highest Rating</a><a class='dropdown-item' onclick='lowRateOrder()'>Lowest Rating</a><a class='dropdown-item' onclick='mostRecOrder()'>Most Recent</a><a class='dropdown-item' onclick='leastRecOrder()'>Least Recent</a></div></div></div>";
            var dayaaa='';


            if(placeData.reviews){
                orderr = [];
                for(po = 0 ; po < placeData.reviews.length ; po++){
                    orderr[po] = po;
                }
                googleRev = true;
                buildReview(orderr);
                
            } else {
                googleRev = false;
            }
            isinfavtab = false;
            showInfo();
            showYReviews();

    }

    function buildReview(orderk){
        

                reviewsText="";

                for(o = 0; o < reviewsData.reviews.length; o++){

                reviewsText += "<div style='border:1px solid #ddd; border-radius:6px; margin-bottom:1%; min-height:75px;'>";

                n = orderk[o];

                if(reviewsData.reviews[n].profile_photo_url){
                    reviewsText += "<div class='col-xl-1 col-lg-1 col-md-2 col-sm-2 col-3' style='margin-top:1.2%;'><a href='"+reviewsData.reviews[n].author_url+"' target='_blank'><img src='"+reviewsData.reviews[n].profile_photo_url+"' style='float:left;' width='100%' height='100%'/></a></div><div class='offset-xl-1 offset-lg-1 offset-md-2 offset-sm-2 offset-3' style='margin-right:1.8%; margin-bottom:1.2%;'>";
                }
                else{
                    reviewsText += "<div class='offset-xl-1 offset-lg-1 offset-md-2 offset-sm-2 offset-3' style='margin-right:1.8%; margin-bottom:1.2%;'>";
                }

                if(reviewsData.reviews[n].author_name){
                    reviewsText += "<b class='card-text text-primary' style='margin-bottom:1%;'><a href='"+reviewsData.reviews[n].author_url+"' target='_blank'>"+reviewsData.reviews[n].author_name+"</a></b><br>";
                }
                else{
                    reviewsText += "";
                }

                if(reviewsData.reviews[n].time){
                    dayaaa = moment.unix(parseInt(reviewsData.reviews[n].time)).utc();
                }
                if(reviewsData.reviews[n].rating){
                    var starss = (reviewsData.reviews[n].rating/5)*22;
                    no_of_starss = "<span class='star-ratingg'><span class='front-starss' style='width:"+starss+"%;'><i class='fa fa-star'></i><i class='fa fa-star'></i><i class='fa fa-star'></i><i class='fa fa-star'></i><i class='fa fa-star'></i></span><span style='float:left; position:relative; margin-top:-4px; margin-left:2px;'>"+dayaaa.format("YYYY-MM-DD HH:MM:SS")+"</span></span>";
                }
                if(reviewsData.reviews[n].time && reviewsData.reviews[n].rating){
                    reviewsText += no_of_starss ;
                }
                else if(reviewsData.reviews[n].time && !reviewsData.reviews[n].rating){
                    reviewsText += dayaaa.format("YYYY-MM-DD HH:MM:SS") + "<br>";
                }
                else if(!reviewsData.reviews[n].time && reviewsData.reviews[n].rating){
                    reviewsText += "<span class='star-ratingg'><span class='front-starss' style='width:"+starss+"%'><i class='fa fa-star'></i><i class='fa fa-star'></i><i class='fa fa-star'></i><i class='fa fa-star'></i><i class='fa fa-star'></i></span></span><br>";
                }
                else{
                    reviewsText += "";
                }

                if(reviewsData.reviews[n].text){
                    reviewsText += reviewsData.reviews[n].text+"</div></div>";
                }
                else{
                    reviewsText += " </div></div>";
                }
                
                }
    }

    function showYReviews(){
        

        var url = "http://newphp21-env.us-east-2.elasticbeanstalk.com/place.php?myToken=mDmd6N8X3NdOMirwAXR-6f8XW3O38KiqrqsaW9cEt2qCsD_wPHw3CNvXprAOKfcmnSR8l16U6ZcbMuLQ72F8Eya7ulF8EI5sSdLwCQGFXyWFde5Ft4vj9LIR78a8WnYx";

        var adr_adr = reviewsData.adr_address;

        $("#dummyDiv").html(adr_adr);


        cityVal = $(".locality").html();
        stateVal = $(".region").html();
        zipVal = $(".postal-code").html();

        if(reviewsData.name){
            url += "&nameOfPlace="+reviewsData.name;
        }
        if(reviewsData.vicinity){
            url += "&address="+reviewsData.vicinity;
        }
        if(reviewsData.adr_address){
            url += "&city="+ cityVal;
            url += "&state="+stateVal;
            url += "&zipCode="+zipVal;
        }
        
        if(reviewsData.geometry.location){
            url += "&location=" + reviewsData.geometry.location;
        }

        url = url.replace(/'/g, '%27');

        //alert(url);

                //Sending request to php to get reviews and photos JSON
                $.getJSON(url, function(result,status){
                    //alert("atlease inside");
                    //alert(result);
                    displayYelpRev(result);

                }).fail(function() {
      $("#cardspacen").html("<br><br><br><br><div class='alert alert-danger' role='alert'>Failed to get Yelp Reviews.</div><br><br><br><br>").css("display","block");
        });
    }

    function displayYelpRev(result){
        reviewsYText = "";
        if(result.results){
                yelpRev = false;
        }
        else{
            yelpreview = result;
             orderr = [];
                for(po = 0 ; po < result.reviews.length ; po++){
                    orderr[po] = po;
                }
                buildYRev(orderr);
                
        }
        
    }

    function buildYRev(orderk){
        yelpRev = true;
            reviewsYText = "";
                for(o = 0; o < yelpreview.reviews.length; o++){

                n = orderk[o];

                reviewsYText += "<div style='border:1px solid #ddd; border-radius:6px; margin-bottom:1%; min-height:75px;'>";

                if(yelpreview.reviews[n].user.image_url){
                    reviewsYText += "<div class='col-xl-1 col-lg-1 col-md-2 col-sm-2 col-3' style='margin-top:1.2%;'><a href='"+yelpreview.reviews[n].url+"' target='_blank'><img src='"+yelpreview.reviews[n].user.image_url+"' class='rounded-circle' style='float:left;' width='65px' height='65px'/></a></div><div class='offset-xl-1 offset-lg-1 offset-md-2 offset-sm-2 offset-3' style='margin-right:1.8%; margin-bottom:1.2%;'>";
                }
                else{
                    reviewsYText += "<div class='col-xl-1 col-lg-1 col-md-2 col-sm-2 col-3' style='margin-top:1.2%;'>gyhhnjn</div><div class='offset-xl-1 offset-lg-1 offset-md-2 offset-sm-2 offset-3' style='margin-right:1.8%; margin-bottom:1.2%;'>";
                }

                if(yelpreview.reviews[n].user.name){
                    reviewsYText += "<b class='card-text text-primary' style='margin-bottom:1%;'><a href='"+yelpreview.reviews[n].url+"' target='_blank'>"+yelpreview.reviews[n].user.name+"</a></b><br>";
                }
                else{
                    reviewsYText += "";
                }

                if(yelpreview.reviews[n].time_created){
                    dayaaa = yelpreview.reviews[n].time_created;
                }
                if(yelpreview.reviews[n].rating){
                    var starss = (yelpreview.reviews[n].rating/5)*25;
                    no_of_starss = "<span class='star-ratingg'><span class='front-starss' style='width:"+starss+"%;'><i class='fa fa-star'></i><i class='fa fa-star'></i><i class='fa fa-star'></i><i class='fa fa-star'></i><i class='fa fa-star'></i></span><span style='float:left; position:relative; margin-top:-4px; margin-left:2px;'>"+dayaaa+"</span></span>";
                }
                if(yelpreview.reviews[n].time_created && yelpreview.reviews[n].rating){
                    reviewsYText += no_of_starss ;
                }
                else if(yelpreview.reviews[n].time_created && !yelpreview.reviews[n].rating){
                    reviewsYText += dayaaa.format("YYYY-MM-DD HH:MM:SS") + "<br>";
                }
                else if(!yelpreview.reviews[n].time_created && yelpreview.reviews[n].rating){
                    reviewsYText += "<span class='star-ratingg'><span class='front-starss' style='width:"+starss+"%'><i class='fa fa-star'></i><i class='fa fa-star'></i><i class='fa fa-star'></i><i class='fa fa-star'></i><i class='fa fa-star'></i></span></span><br>";
                }
                else{
                    reviewsYText += "";
                }

                if(yelpreview.reviews[n].text){
                    reviewsYText += yelpreview.reviews[n].text+"</div></div>";
                }
                else{
                    reviewsYText += " </div></div>";
                }
                
                }
    }

    function showYelRev(){
        document.getElementById("dropdownMenuButton").innerHTML  = "Yelp Reviews";
        $("#cardspace").html('');
        $("#cardspacen").html('');
        var elemWithScope = document.querySelector('[ng-app=myApp]');
        var $scope = angular.element(elemWithScope).scope();
        $scope.$apply(function() {
            $scope.showed = true;
            $scope.show = false;
        });
        if(yelpRev == true){
            $("#cardspaced").html(reviewsYText);
        } else {
            $("#cardspaced").html("<br><br><br><br><div class='alert alert-warning' role='alert'>No Records.</div><br><br><br><br>");
            reviewsYText = "";
        }
    }


    function showInfo() {
        favjustanim = false;
        shouldishow = true;
        document.getElementById("sometextfield").value = 'shownow';
        document.getElementById("recentlyvisited").value = reviewsData.place_id;
        $("#revli").removeClass( "active" ).css("color","dodgerblue");
        $("#mapli").removeClass( "active" ).css("color","dodgerblue");
        $("#photoli").removeClass( "active" ).css("color","dodgerblue");
        $( "#infoli" ).addClass( "active" ).css("color","#444");
        $("#photossTab").css("display","none");
        $("#mapForm").css("display","none");
        $("#map").removeClass("visible").addClass("invisible");
        $("#mapPanel").html('');
        $("#mapend").html('');
        $("#cardspace").html('');
        $("#cardspacen").html('');
        $("#cardspaced").html('');
        $("#cardrevspace").html('');
        $("#map").css("height","1px");
        $("#myTable").css("display","none");
        $("#showAnimated").removeClass("animated slideInRight");
        var elemWithScope = document.querySelector('[ng-app=myApp]');
        var $scope = angular.element(elemWithScope).scope();
        $scope.$apply(function() {
            $scope.myValue = false;
        });
        $("#infoTabb").html('').html(info);
    }

    function showPhotos() {
        $( "#infoli" ).removeClass( "active" ).css("color","dodgerblue");
        $("#revli").removeClass( "active" ).css("color","dodgerblue");
        $("#mapli").removeClass( "active" ).css("color","dodgerblue");
        $("#photoli").addClass( "active" ).css("color","#444");
        $("#mapForm").css("display","none");
        $("#map").removeClass("visible").addClass("invisible");
        $("#mapPanel").html('');
        $("#cardspace").html('');
        $("#cardspaced").html('');
        $("#cardspacen").html('');
        $("#cardrevspace").html('');
        $("#map").css("height","1px");
        $("#infoTabb").html('');
        $("#photossTab").css("display","block");
        $("#mapend").html("<br>");
    }

    function showMap() {
        $( "#infoli" ).removeClass( "active" ).css("color","dodgerblue");
        $("#revli").removeClass( "active" ).css("color","dodgerblue");
        $("#photoli").removeClass( "active" ).css("color","dodgerblue");
        $("#mapli").addClass( "active" ).css("color","#444");
        $("#photossTab").css("display","none");
        $("#cardspace").html('');
        $("#cardspaced").html('');
        $("#cardspacen").html('');
        $("#cardrevspace").html('');
        $("#map").css("height","400px");
        if(setPanelx == true){
            directionsDisplay.setPanel(document.getElementById('mapPanel'));
        }
        $("#infoTabb").html(maptab);
        $("#mapForm").css("display","block");
        $("#map").removeClass("invisible").addClass("visible");
        $("#mapend").html("<br>");

    }

    function showReviews() {
        $( "#infoli" ).removeClass( "active" ).css("color","dodgerblue");
        $("#photoli").removeClass( "active" ).css("color","dodgerblue");
        $("#mapli").removeClass( "active" ).css("color","dodgerblue");
        $("#revli").addClass( "active" ).css("color","#444");
        $("#photossTab").css("display","none");
        $("#mapForm").css("display","none");
        $("#map").removeClass("visible").addClass("invisible");
        $("#mapPanel").html('');
        $("#mapend").html('');
        $("#map").css("height","1px");
        $("#infoTabb").html('');
        $("#mapForm").css("display","none");
        $("#cardrevspace").html(reviewsHeadText);
        $("#cardspaced").html('');
        $("#cardspacen").html('');
        if(googleRev == false){
            var elemWithScope = document.querySelector('[ng-app=myApp]');
            var $scope = angular.element(elemWithScope).scope();
            $scope.$apply(function() {
                $scope.show = true;
                $scope.showed = false;
            });
            $("#cardspace").html("<br><br><br><br><div class='alert alert-warning' role='alert'>No Records.</div><br><br><br><br>");
        }
        else{
            var elemWithScope = document.querySelector('[ng-app=myApp]');
            var $scope = angular.element(elemWithScope).scope();
            $scope.$apply(function() {
                $scope.show = true;
                $scope.showed = false;
            });
            $("#cardspace").html(reviewsText);
        }
        
    }

    function displayDirec(startLoc, travel){
            travell = travel;
            var geocoder;
            
            $("#mapPanel").html('');

            if(startLoc == "Your Location" || startLoc == "My Location" || startLoc == "my location" || startLoc == "my Location" || startLoc == "My location" || startLoc == "your Location" || startLoc == "Your location" || startLoc == "your location"){
        
                if($("#here2").is(":checked")){
                    originn = {lat:parseFloat(userLat),lng:parseFloat(userLng)};
                    displaychangedDir(originn, travell);
                }
                else{
                    originn = {lat:lat,lng:lng};
                    displaychangedDir(originn, travell);
                }
                
            } else {
                if($("#here2").is(":checked") && startLoc == document.getElementById('location').value){
                    originn = {lat:parseFloat(userLat),lng:parseFloat(userLng)};
                    displaychangedDir(originn, travell);
                }
                else{
                    geocoder = new google.maps.Geocoder();
                    var address = document.getElementById('from').value;
                    geocoder.geocode({'address': address}, function(results, status) {
                        if (status == 'OK') {
                            originn = results[0].geometry.location;
                            displaychangedDir(originn, travell);
                        } else {
                            if(status ==  "ZERO_RESULTS"){
                                alert("No results found for specified location!!");
                            }
                            else if(status == "ERROR"){
                                alert("Geocode was not successfull in getting your location. Please check your internet connection.");
                            }
                            else{
                                alert('Something went wrong with geocode. Please try again !');
                            }
                            
                        }
                    });
                }
            }     
            
        }

        var panorama;

        function displaychangedDir(originn, travel){

            

            mapOptions = {
                zoom: 15,
                center : reviewsData.geometry.location,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                streetViewControl: false
            };

            map = new google.maps.Map(document.getElementById('map'), mapOptions);
                var directionsService = new google.maps.DirectionsService;
            directionsService.route({
                origin: originn,
                destination: reviewsData.geometry.location,
                travelMode: travel,
                provideRouteAlternatives: true
            }, function(response, status) {
                if (status === 'OK') {
                    directionsDisplay.setDirections(response);
                } else {
                    alert('Directions not present for ' + travel);
                }
            });
            directionsDisplay = new google.maps.DirectionsRenderer({
                map: map
            });

            directionsDisplay.setPanel(document.getElementById('mapPanel')); 
            setPanelx = true; 

            panorama = map.getStreetView();
            panorama.setPosition(reviewsData.geometry.location);
            panorama.setPov(/** @type {google.maps.StreetViewPov} */({
            heading: 265,
            pitch: 0
            }));


        }
        function highRateOrder(){
            $("#dropdownOrderMenuButton").html("Highest Rating");
            var elemWithScope = document.querySelector('[ng-app=myApp]');
            var $scope = angular.element(elemWithScope).scope();
            $scope.$apply(function() {
            $scope.showed = false;
            $scope.show = false;
            });

            lowtohight = false;

            if(document.getElementById("dropdownMenuButton").innerHTML == "Google Reviews" && googleRev == true){
                //reviewsg = [;
                for(t=0;t<reviewsData.reviews.length;t++){
                    rateg[t] = reviewsData.reviews[t].rating;
                    rategf[t] = t;
                }
                grev = true;
                bubbleSort(rateg,rategf);
            }
            else if(document.getElementById("dropdownMenuButton").innerHTML == "Yelp Reviews"){

                if(yelpRev == true){
                    for(t=0;t<yelpreview.reviews.length;t++){
                    rateg[t] = yelpreview.reviews[t].rating;
                    rategf[t] = t;
                }
                grev=false;
                bubbleSort(rateg,rategf);
                }
                else{
                    $("#cardspaced").html('');
                    $("#cardspace").html('');
                    $("#cardspacen").html("<br><br><br><br><div class='alert alert-warning' role='alert'>No Records.</div><br><br><br><br>");
                }
            }
            if(googleRev == false){
                $("#cardspaced").html('');
                $("#cardspace").html('');
                $("#cardspacen").html("<br><br><br><br><div class='alert alert-warning' role='alert'>No Records.</div><br><br><br><br>");
            }
        }

        function bubbleSort(arr,rategf){
            var len = arr.length;
            for (var i = len-1; i>=0; i--){
                for(var j = 1; j<=i; j++){
                    if(arr[j-1]>arr[j]){
                        var temp = arr[j-1];
                        var temp1 = rategf[j-1];
                        arr[j-1] = arr[j];
                        rategf[j-1] = rategf[j];
                        arr[j] = temp;
                        rategf[j] = temp1;
                    }
                }
            }
            //alert(rategf);
            if(!lowtohight){
                rategf.reverse(); 
            }
            if(grev){
                buildReview(rategf);
                $("#cardspace").html('');
                $("#cardspaced").html('');
                $("#cardspacen").html(reviewsText);
            }
            else{
                buildYRev(rategf)
                $("#cardspace").html('');
                $("#cardspaced").html('');
                $("#cardspacen").html(reviewsYText);
            }

            
        }

        function defaultOrder(){
            var elemWithScope = document.querySelector('[ng-app=myApp]');
            var $scope = angular.element(elemWithScope).scope();
            $scope.$apply(function() {
            $scope.showed = false;
            $scope.show = false;
            });
            $("#dropdownOrderMenuButton").html("Default Order");
            orderr = [];
            if(document.getElementById("dropdownMenuButton").innerHTML == "Google Reviews" && googleRev == true){
                for(po = 0 ; po < reviewsData.reviews.length ; po++){
                    orderr[po] = po;
                }
                buildReview(orderr);
                $("#cardspaced").html('');
                $("#cardspace").html('');
            $("#cardspacen").html(reviewsText);
        }
        else if(document.getElementById("dropdownMenuButton").innerHTML == "Yelp Reviews"){
            if(yelpRev == true){
                for(t=0;t<yelpreview.reviews.length;t++){
                    orderr[t] = t;
                }
                buildYRev(orderr);
                $("#cardspaced").html('');
                $("#cardspace").html('');
                $("#cardspacen").html(reviewsYText);
            } else {
                $("#cardspace").html('');
                $("#cardspaced").html('');
                $("#cardspacen").html("<br><br><br><br><div class='alert alert-warning' role='alert'>No Records.</div><br><br><br><br>");
            }
            
        }
        if(googleRev == false){
            $("#cardspace").html('');
                $("#cardspaced").html('');
            $("#cardspacen").html("<br><br><br><br><div class='alert alert-warning' role='alert'>No Records.</div><br><br><br><br>");
        }
        }

        function lowRateOrder(){
            var elemWithScope = document.querySelector('[ng-app=myApp]');
            var $scope = angular.element(elemWithScope).scope();
            $scope.$apply(function() {
            $scope.showed = false;
            $scope.show = false;
            });
            $("#dropdownOrderMenuButton").html("Lowest Rating");
            if(document.getElementById("dropdownMenuButton").innerHTML == "Google Reviews" && googleRev == true){
                //reviewsg = [;
                for(t=0;t<reviewsData.reviews.length;t++){
                    rateg[t] = reviewsData.reviews[t].rating;
                    rategf[t] = t;
                }

                grev = true;

                lowtohight = true;

                bubbleSort(rateg,rategf);
            }
            else if(document.getElementById("dropdownMenuButton").innerHTML == "Yelp Reviews"){

                if(yelpRev == true){
                    for(t=0;t<yelpreview.reviews.length;t++){
                    rateg[t] = yelpreview.reviews[t].rating;
                    rategf[t] = t;
                }
                grev=false;
                lowtohight = true;
                bubbleSort(rateg,rategf);
                } else {
                    $("#cardspace").html('');
                $("#cardspaced").html('');
                    $("#cardspacen").html("<br><br><br><br><div class='alert alert-warning' role='alert'>No Records.</div><br><br><br><br>");
                }

            }
            if(googleRev == false){
                $("#cardspace").html('');
                $("#cardspaced").html('');
                $("#cardspacen").html("<br><br><br><br><div class='alert alert-warning' role='alert'>No Records.</div><br><br><br><br>");
            }

        }

        function mostRecOrder(){
            var elemWithScope = document.querySelector('[ng-app=myApp]');
            var $scope = angular.element(elemWithScope).scope();
            $scope.$apply(function() {
            $scope.showed = false;
            $scope.show = false;
            });
            $("#dropdownOrderMenuButton").html("Most Recent");
            if(document.getElementById("dropdownMenuButton").innerHTML == "Google Reviews" && googleRev == true){
                //reviewsg = [;
                for(t=0;t<reviewsData.reviews.length;t++){
                    rategdate[t] = reviewsData.reviews[t].time;
                    dayaaa = moment.unix(parseInt(reviewsData.reviews[t].time)).utc();
                    rategfdate[t] = t;
                }

                mostrecgrev = true;

                mostrec = true;

                bubbleSortDate(rategdate,rategfdate);
            }
            else if(document.getElementById("dropdownMenuButton").innerHTML == "Yelp Reviews"){

                if(yelpRev == true){
                    for(t=0;t<yelpreview.reviews.length;t++){
                    rategdate[t] = moment(yelpreview.reviews[t].time_created).unix();
                    //alert(moment(yelpreview.reviews[t].time_created).unix());
                    rategfdate[t] = t;
                }
                mostrecgrev = false;
                mostrec = true;
                bubbleSortDate(rategdate,rategfdate);
                } else {
                    $("#cardspace").html('');
                $("#cardspaced").html('');
                    $("#cardspacen").html("<br><br><br><br><div class='alert alert-warning' role='alert'>No Records.</div><br><br><br><br>");
                }

                

            }
            if(googleRev == false){
                $("#cardspace").html('');
                $("#cardspaced").html('');
                $("#cardspacen").html("<br><br><br><br><div class='alert alert-warning' role='alert'>No Records.</div><br><br><br><br>");
            }
        }
        function bubbleSortDate(arr,rategfdate){
            var len = arr.length;
            for (var i = len-1; i>=0; i--){
                for(var j = 1; j<=i; j++){
                    if(arr[j-1]>arr[j]){
                        temp = arr[j-1];
                        temp1 = rategfdate[j-1];
                        arr[j-1] = arr[j];
                        rategfdate[j-1] = rategfdate[j];
                        arr[j] = temp;
                        rategfdate[j] = temp1;
                    }
                }
            }
            //alert(rategfdate);
            if(mostrec){
                rategfdate.reverse(); 
            }
            if(mostrecgrev){
                buildReview(rategfdate);
                $("#cardspace").html('');
                $("#cardspaced").html('');
                $("#cardspacen").html(reviewsText);
            }
            else{
                buildYRev(rategfdate)
                $("#cardspace").html('');
                $("#cardspaced").html('');
                $("#cardspacen").html(reviewsYText);
            }
            

            
        }

        function leastRecOrder(){
            var elemWithScope = document.querySelector('[ng-app=myApp]');
            var $scope = angular.element(elemWithScope).scope();
            $scope.$apply(function() {
            $scope.showed = false;
            $scope.show = false;
            });
            $("#dropdownOrderMenuButton").html("Least Recent");
            if(document.getElementById("dropdownMenuButton").innerHTML == "Google Reviews" && googleRev == true){
                //reviewsg = [;
                for(t=0;t<reviewsData.reviews.length;t++){
                    rategdate[t] = reviewsData.reviews[t].time;
                    dayaaa = moment.unix(parseInt(reviewsData.reviews[t].time)).utc();
                    rategfdate[t] = t;
                }

                mostrecgrev = true;

                mostrec = false;

                bubbleSortDate(rategdate,rategfdate);
            }
            else if(document.getElementById("dropdownMenuButton").innerHTML == "Yelp Reviews"){
                if(yelpRev == true){

                for(t=0;t<yelpreview.reviews.length;t++){
                    rategdate[t] = moment(yelpreview.reviews[t].time_created).unix();
                    //alert(moment(yelpreview.reviews[t].time_created).unix());
                    rategfdate[t] = t;
                }
                mostrecgrev = false;
                mostrec = false;
                bubbleSortDate(rategdate,rategfdate);
            } else {
                $("#cardspace").html('');
                $("#cardspaced").html('');
                $("#cardspacen").html("<br><br><br><br><div class='alert alert-warning' role='alert'>No Records.</div><br><br><br><br>");
            }

            }
            if(googleRev == false){
                $("#cardspace").html('');
                $("#cardspaced").html('');
                $("#cardspacen").html("<br><br><br><br><div class='alert alert-warning' role='alert'>No Records.</div><br><br><br><br>");
            }
        }

        function streetViewToggle(){
                var toggle = panorama.getVisible();
                if (toggle == false) {
                    document.getElementById("imageicon").src = "http://cs-server.usc.edu:45678/hw/hw8/images/Map.png";
                    panorama.setVisible(true);
                } else {
                    document.getElementById("imageicon").src = "http://cs-server.usc.edu:45678/hw/hw8/images/Pegman.png";
                    panorama.setVisible(false);
            }
        }

</script>

<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCNkEjbPhrb2xUAsYZTL8RCKr43KlkM_3I&libraries=places&callback=initMap"></script>

</body>
</html>